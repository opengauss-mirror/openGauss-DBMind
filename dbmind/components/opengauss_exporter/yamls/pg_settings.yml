# Copyright (c) 2022 Huawei Technologies Co.,Ltd.
#
# openGauss is licensed under Mulan PSL v2.
# You can use this software according to the terms and conditions of the Mulan PSL v2.
# You may obtain a copy of Mulan PSL v2 at:
#
#          http://license.coscl.org.cn/MulanPSL2
#
# THIS SOFTWARE IS PROVIDED ON AN "AS IS" BASIS, WITHOUT WARRANTIES OF ANY KIND,
# EITHER EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO NON-INFRINGEMENT,
# MERCHANTABILITY OR FIT FOR A PARTICULAR PURPOSE.
# See the Mulan PSL v2 for more details.

pg_settings:
  name: pg_settings
  desc: OpenGauss database settings
  query: |-
    SELECT 
      name,
      CASE WHEN vartype = 'bool' THEN (CASE WHEN setting = 'on' THEN 1. ELSE 0. END) ELSE setting::FLOAT END AS setting,
      vartype 
    FROM 
      pg_catalog.pg_settings
    WHERE 
      vartype NOT IN ('enum', 'string')
      AND 
      name NOT SIMILAR TO '(audit_%|dcf_%|debug_%|password_%)';
  metrics:
    - name: name
      description: GUC name
      usage: LABEL
    - name: setting
      description: GUC value
      usage: GAUGE
    - name: vartype
      description: GUC type
      usage: LABEL
  status: enable
  ttl: 10
  timeout: 1